{# dashboard/templates/partials/_positions.html #}

<div class="common-box light-mode mini-table-box" id="miniTableBox">
  <div class="chart-label" style="margin-bottom: 15px;">Positions</div>

  <div id="positionsContainer" class="positions-container">
    <table id="positionsTable">
      <thead>
        <tr>
          <th onclick="sortTable('positionsTable', 0)">Asset</th>
          <th onclick="sortTable('positionsTable', 1)">Wallet</th>
          <th onclick="sortTable('positionsTable', 2)">Heat Index</th>
          <th onclick="sortTable('positionsTable', 3)">Travel %</th>
          <th onclick="sortTable('positionsTable', 4)">Leverage</th>
        </tr>
      </thead>
      <tbody>
        {% for pos in positions %}
        <tr>
          <td>
            {% set asset = pos.asset_type|default('BTC')|lower %}
            {% if asset == 'btc' %}
              <img class="asset-icon" src="{{ url_for('static', filename='images/btc_logo.png') }}" alt="BTC Icon">
            {% elif asset == 'eth' %}
              <img class="asset-icon" src="{{ url_for('static', filename='images/eth_logo.png') }}" alt="ETH Icon">
            {% elif asset == 'sol' %}
              <img class="asset-icon" src="{{ url_for('static', filename='images/sol_logo.png') }}" alt="SOL Icon">
            {% else %}
              <img class="asset-icon" src="https://via.placeholder.com/32" alt="{{ asset|upper }} Icon">
            {% endif %}
          </td>

          <td>
            {% set wallet = pos.wallet|default(pos.wallet_name|default('ObiVault')) %}
            {% if wallet == 'ObiVault' %}
              <img class="wallet-icon" src="{{ url_for('static', filename='images/obivault.jpg') }}" alt="ObiVault">
            {% elif wallet == 'R2Vault' %}
              <img class="wallet-icon" src="{{ url_for('static', filename='images/r2vault.jpg') }}" alt="R2Vault">
            {% else %}
              <img class="wallet-icon" src="{{ url_for('static', filename='images/obivault.jpg') }}" alt="Wallet">
            {% endif %}
          </td>

          <td>
            {% if pos.heat_index is defined and pos.heat_index is not none %}
              <strong>{{ pos.heat_index|int }}</strong>
            {% else %}
              N/A
            {% endif %}
          </td>

          <td>
            {% if pos.travel_percent is defined and pos.travel_percent is not none %}
              {{ "{:,.2f}".format(pos.travel_percent) }}%
            {% else %}
              N/A
            {% endif %}
          </td>

          <td>
            {% if pos.leverage is defined and pos.leverage is not none %}
              {{ "{:,.2f}".format(pos.leverage) }}
            {% else %}
              N/A
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
