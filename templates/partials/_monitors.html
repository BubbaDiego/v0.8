<!-- partials/_monitors.html -->
<div class="monitor-row">

  <div id="price-monitor" class="monitor-card">
    <div class="label">Price</div>
    <div class="monitor-icon">üìà</div>
    <div class="monitor-text" id="price-monitor-time"></div>
  </div>

  <div id="positions-monitor" class="monitor-card">
    <div class="label">Positions</div>
    <div class="monitor-icon">üìä</div>
    <div class="monitor-text" id="positions-monitor-time"></div>
  </div>

  <div id="operations-monitor" class="monitor-card">
    <div class="label">Operations</div>
    <div class="monitor-icon">‚öôÔ∏è</div>
    <div class="monitor-text" id="operations-monitor-time"></div>
  </div>

  <div id="xcom-monitor" class="monitor-card">
    <div class="label">Xcom</div>
    <div class="monitor-icon">üõ∞Ô∏è</div>
    <div class="monitor-text" id="xcom-monitor-time"></div>
  </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  function formatTime(isoString) {
    if (!isoString) return 'N/A';
    try {
      const date = new Date(isoString);
      let hours = date.getHours();
      const minutes = date.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      return `${hours}:${minutes} ${ampm}`;
    } catch (e) {
      return 'N/A';
    }
  }

  document.getElementById('price-monitor-time').textContent = formatTime("{{ ledger_info.last_price_time or '' }}");
  document.getElementById('positions-monitor-time').textContent = formatTime("{{ ledger_info.last_positions_time or '' }}");
  document.getElementById('operations-monitor-time').textContent = formatTime("{{ ledger_info.last_cyclone_time or '' }}");
  document.getElementById('xcom-monitor-time').textContent = formatTime("{{ ledger_info.last_cyclone_time or '' }}");

  const monitorAges = {
    'price-monitor': {{ ledger_info.age_price or 9999 }},
    'positions-monitor': {{ ledger_info.age_positions or 9999 }},
    'operations-monitor': {{ ledger_info.age_cyclone or 9999 }},
    'xcom-monitor': {{ ledger_info.age_cyclone or 9999 }}
  };

  Object.entries(monitorAges).forEach(([id, age]) => {
    const card = document.getElementById(id);
    if (!card) return;
    if (age <= 300) {
      card.classList.add('fresh-muted');
    } else if (age <= 900) {
      card.classList.add('warning-muted');
    } else {
      card.classList.add('stale-pulse');
    }
  });
});
</script>

<style>
.monitor-row {
  display: flex;
  gap: 1rem;
  justify-content: center;
}
.monitor-card {
  color: var(--card-title-color, #eee);
  width: 120px;
  min-height: 55px;
  border-radius: 1rem;
  padding: 0.2rem;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: start;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
  background-color: var(--card-background-color, #2a2a2a);
}
.monitor-card:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}
.monitor-icon {
  font-size: 1.2rem;
  margin-top: 0.2rem;
  margin-bottom: 0.2rem;
}
.monitor-text {
  font-size: 0.8rem;
  margin-top: 0.3rem;
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
/* Updated Label */
.label {
  background: none;
  width: auto;
  font-size: 0.85rem;
  padding: 0.1rem 0.2rem;
  border-radius: 0;
  text-align: center;
  font-weight: 600;
  color: #333;
  margin-top: 0.2rem;
}

@media (prefers-color-scheme: dark) {
  .label {
    color: #ddd;
  }
}

/* Freshness States */
.fresh-muted { background-color: #d4edda; color: #155724; }
.warning-muted { background-color: #fff3cd; color: #856404; }
.stale-pulse { background-color: #f8d7da; color: #721c24; animation: pulse 2s infinite; }

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
</style>
