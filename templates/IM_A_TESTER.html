// alert_monitor.js

const alerts = [
  {
    asset: 'BTC',
    starting_value: 40000,
    trigger_value: 60000,
    evaluated_value: 52000,
    level: 'Medium',
    condition: 'ABOVE',
    thresholds: { low: 10000, medium: 25000, high: 50000 },
    last_triggered: '2024-12-01T12:34:56Z'
  },
  {
    asset: 'ETH',
    starting_value: 1800,
    trigger_value: 2200,
    evaluated_value: 2000,
    level: 'Low',
    condition: 'ABOVE',
    thresholds: { low: 1200, medium: 1600, high: 2100 },
    last_triggered: '2024-12-02T10:20:30Z'
  }
];

function loadAlerts(alertList) {
  alerts.forEach(alert => {
    const start = alert.starting_value ?? 0;
    const trigger = alert.trigger_value ?? 0;
    const current = alert.evaluated_value ?? 0;

    let travelPercent = 0;
    if (trigger !== start) {
      travelPercent = ((current - start) / (trigger - start)) * 100;
      travelPercent = Math.min(Math.max(travelPercent, -100), 100);
    }

    const row = document.createElement('div');
    row.className = 'alert-row';

    const flipCard = document.createElement('div');
    flipCard.className = 'flip-card';
    flipCard.innerHTML = `
      <div class="flip-card-front">
        <img src="/static/images/${alert.asset.toLowerCase()}_logo.png" class="asset-icon" onerror="this.src='/static/images/unknown.png'">
        <div class="alert-info">
          <strong>${alert.asset}</strong><br>${alert.level}
        </div>
        <div class="progress-bar-container">
          <div class="midline"></div>
          <div class="bar-fill ${travelPercent >= 0 ? 'positive' : 'negative'}"
               style="${travelPercent >= 0
                 ? `left:50%;width:${travelPercent}%` : `right:50%;width:${Math.abs(travelPercent)}%`}">
            ${travelPercent.toFixed(1)}%
          </div>
        </div>
        <div class="level-badge level-${alert.level}">${alert.level.charAt(0)}</div>
      </div>
      <div class="flip-card-back">
        <div class="flip-details">
          <div><strong>Evaluated:</strong> ${alert.evaluated_value}</div>
          <div><strong>Trigger:</strong> ${alert.trigger_value}</div>
          <div><strong>Starting:</strong> ${alert.starting_value}</div>
          <div><strong>Condition:</strong> ${alert.condition}</div>
          <div><strong>Thresholds:</strong> Low ${alert.thresholds.low}, Medium ${alert.thresholds.medium}, High ${alert.thresholds.high}</div>
          <div><strong>Last Triggered:</strong> ${new Date(alert.last_triggered).toLocaleString()}</div>
        </div>
      </div>
    `;

    flipCard.addEventListener('click', () => {
      flipCard.classList.toggle('flipped');
    });

    row.appendChild(flipCard);
    alertList.appendChild(row);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const alertList = document.getElementById('alertList');
  loadAlerts(alertList);
});
