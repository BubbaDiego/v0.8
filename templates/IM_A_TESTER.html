{% extends "base.html" %}
{% block title %}Console Logs + Limits{% endblock %}

{% block extra_styles %}
{{ super() }}
<style>
  .logger-box {
    max-height: 350px;
    overflow-y: auto;
    font-family: monospace;
    background: #111;
    color: #eee;
    border: 1px solid #444;
    border-radius: 8px;
    padding: 1rem;
  }
  .log-line {
    padding: 0.3rem;
    border-left: 4px solid;
    margin-bottom: 4px;
    background: #1e1e1e;
    border-radius: 4px;
  }
  .log-info { border-color: #3498db; color: #3498db; }
  .log-success { border-color: #2ecc71; color: #2ecc71; }
  .log-warning { border-color: #f1c40f; color: #f1c40f; }
  .log-error { border-color: #e74c3c; color: #e74c3c; }
  .log-debug { border-color: #e67e22; color: #e67e22; }
  .log-confidence { border-color: #00ffff; color: #00ffff; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid pt-4">

  <h3 class="mb-4">üñ•Ô∏è Console Log Viewer</h3>
  <div class="logger-box mb-5" id="loggerContent">
    <!-- Live log lines go here -->
  </div>

  <hr>

  <h3 class="mb-3">‚öôÔ∏è Alert Limits Editor</h3>
  <form id="alertForm" method="POST" action="{{ url_for('alerts_bp.update_alert_config') }}">
    <div class="row mb-4">
      <div class="col-md-4">
        <label class="form-label">Profit Threshold</label>
        <input type="number" step="0.01" class="form-control" name="thresholds[profit]" value="10">
      </div>
      <div class="col-md-4">
        <label class="form-label">Travel Threshold</label>
        <input type="number" step="0.01" class="form-control" name="thresholds[travel_percent]" value="15">
      </div>
      <div class="col-md-4">
        <label class="form-label">Heat Index Threshold</label>
        <input type="number" step="0.01" class="form-control" name="thresholds[heat_index]" value="50">
      </div>
    </div>
    <button type="submit" class="btn btn-primary">üíæ Save Limits</button>
  </form>

</div>
{% endblock %}

{% block extra_scripts %}
{{ super() }}
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const socket = io();
  const loggerBox = document.getElementById("loggerContent");

  function addLogLine(level, icon, text) {
    const div = document.createElement("div");
    div.className = `log-line log-${level}`;
    div.textContent = `${icon} ${text}`;
    loggerBox.appendChild(div);
    loggerBox.scrollTop = loggerBox.scrollHeight;
  }

  socket.on("new_log", function(log) {
    addLogLine(log.level, log.icon, log.text);
  });

  // Load initial history
  fetch("/api/logs")
    .then(res => res.json())
    .then(logs => logs.forEach(log => addLogLine(log.level, log.icon, log.text)));
</script>
{% endblock %}
