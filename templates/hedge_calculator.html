{% extends "base.html" %}
{% block title %}Hedge Calculator{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/hedge_calculator.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid page-container">
  <!-- Display Mode Radio Buttons -->
  <div class="d-flex justify-content-center mb-3" id="displayModeControls">
    <div class="btn-group" role="group">
      <input type="radio" class="btn-check" name="displayMode" id="modeFull" autocomplete="off" checked onchange="setDisplayMode('full')">
      <label class="btn btn-outline-primary" for="modeFull"><i class="fas fa-chart-line"></i></label>
      <input type="radio" class="btn-check" name="displayMode" id="modeGear" autocomplete="off" onchange="setDisplayMode('gear')">
      <label class="btn btn-outline-primary" for="modeGear"><i class="fas fa-wrench"></i></label>
      <input type="radio" class="btn-check" name="displayMode" id="modeTestTube" autocomplete="off" onchange="setDisplayMode('test')">
      <label class="btn btn-outline-primary" for="modeTestTube"><i class="fas fa-vial" style="color: green;"></i></label>
    </div>
  </div>

  <!-- Main Card for Hedge Calculator -->
  <div class="card shadow mb-4">
    <div class="card-header position-relative" style="background-color: var(--card-title-color);">
      <h4 class="mb-0 text-center" style="color: var(--text-color);">ü¶î Hedge Calculator</h4>
      <button id="saveModifiers" class="btn btn-sm btn-outline-secondary position-absolute" style="top: 10px; right: 10px;" title="Save Modifiers">
        <i class="fa-solid fa-floppy-disk"></i>
      </button>
    </div>
    <div class="card-body">
      <!-- Row 1: Input Boxes for Long & Short Positions -->
      <div id="positionInputRow" class="row mb-4">
        <div class="col-md-6 mb-3">
          <div class="border rounded p-3" style="background-color: #f7f7f7;">
            <h5 class="text-center">üìà Long Position</h5>
            <div class="mb-2">
              <label for="longSelect" class="form-label"><strong>Select Long Position</strong></label>
              <select id="longSelect" class="form-select" onchange="loadLongPosition()">
                <option value="" disabled selected>-- Choose a Position --</option>
                {% for pos in long_positions %}
                <option value="{{ pos.id }}">{{ pos.asset_type }} - Entry: ${{ pos.entry_price }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-2">
              <label for="longEntry" class="form-label"><strong>Entry Price ($):</strong></label>
              <input type="number" id="longEntry" class="form-control" step="any" readonly />
            </div>
            <div class="mb-2">
              <label for="longSize" class="form-label"><strong>Position Size (USD):</strong></label>
              <input type="number" id="longSize" class="form-control" step="any" />
            </div>
            <input type="hidden" id="longCollateral" />
            <input type="hidden" id="longLiqPrice" />
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="border rounded p-3" style="background-color: #f7f7f7;">
            <h5 class="text-center">üìâ Short Position</h5>
            <div class="mb-2">
              <label for="shortSelect" class="form-label"><strong>Select Short Position</strong></label>
              <select id="shortSelect" class="form-select" onchange="loadShortPosition()">
                <option value="" disabled selected>-- Choose a Position --</option>
                {% for pos in short_positions %}
                <option value="{{ pos.id }}">{{ pos.asset_type }} - Entry: ${{ pos.entry_price }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="mb-2">
              <label for="shortEntry" class="form-label"><strong>Entry Price ($):</strong></label>
              <input type="number" id="shortEntry" class="form-control" step="any" readonly />
            </div>
            <div class="mb-2">
              <label for="shortSize" class="form-label"><strong>Position Size (USD):</strong></label>
              <input type="number" id="shortSize" class="form-control" step="any" />
            </div>
            <input type="hidden" id="shortCollateral" />
            <input type="hidden" id="shortLiqPrice" />
          </div>
        </div>
      </div>

      <!-- Row 2: Modifier Boxes -->
      <div id="modifierRow" class="row mb-4">
        <div class="col-md-6 mb-3">
          <div class="border rounded p-3" style="background-color: #f7f7f7;">
            <h5 class="text-center"><strong>‚öôÔ∏è Hedge Modifiers üîß</strong></h5>
            <div class="mb-3">
              <label for="feePercentage" class="form-label"><strong>üí≤ Fee (% of total size):</strong></label>
              <input type="number" id="feePercentage" class="form-control" step="any" value="{{ modifiers.hedge_modifiers.feePercentage }}" />
            </div>
            <div class="mb-3">
              <label for="targetMarginInput" class="form-label"><strong>üìè Target Safety Margin (%)</strong></label>
              <input type="number" id="targetMarginInput" class="form-control" step="0.1" value="{{ modifiers.hedge_modifiers.targetMargin }}">
            </div>
            <div class="mb-3">
              <label for="adjustmentFactorInput" class="form-label"><strong>üîß Adjustment Factor</strong></label>
              <input type="number" id="adjustmentFactorInput" class="form-control" step="0.1" value="{{ modifiers.hedge_modifiers.adjustmentFactor }}">
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="border rounded p-3" style="background-color: #f7f7f7;">
            <h5 class="text-center"><strong>‚öôÔ∏è Heat Modifiers üîß</strong></h5>
            <div class="mb-3">
              <label for="distanceWeightInput" class="form-label"><strong>üìè Distance Weight</strong></label>
              <input type="number" id="distanceWeightInput" class="form-control" step="0.01" value="{{ modifiers.heat_modifiers.distanceWeight }}" />
            </div>
            <div class="mb-3">
              <label for="leverageWeightInput" class="form-label"><strong>üìä Leverage Weight</strong></label>
              <input type="number" id="leverageWeightInput" class="form-control" step="0.01" value="{{ modifiers.heat_modifiers.leverageWeight }}" />
            </div>
            <div class="mb-3">
              <label for="collateralWeightInput" class="form-label"><strong>üí∞ Collateral Weight</strong></label>
              <input type="number" id="collateralWeightInput" class="form-control" step="0.01" value="{{ modifiers.heat_modifiers.collateralWeight }}" />
            </div>
          </div>
        </div>
      </div>

      <!-- Simplified output rows omitted for brevity -->
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='js/hedge_calculator.js') }}"></script>
{% endblock %}
